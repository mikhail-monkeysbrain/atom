function UrlMarkup(e){var t="undefined"!=typeof e.disabled&&1==e.disabled?" disabled ":" ",n="undefined"!=typeof e.readonly&&1==e.readonly?" readonly ":" ";return{markup:'<label for="'+e.name+'" class="col-sm-2">'+e.title+" "+(e.require?'<span class="require">*</span>':"")+'</label><div class="col-sm-10"><div class="input-group"><span class="input-group-addon">{{form.'+e.name+".urlPrefix}}</span><input "+t+n+' id="'+e.name+'"  type="text" class="form-control" data-ng-model="form.'+e.name+'.displayUrl"></div></div>',callback:function(e){return!0}}}function TextareaMarkup(e){var t="undefined"!=typeof e.disabled&&1==e.disabled?" disabled ":" ",n="undefined"!=typeof e.readonly&&1==e.readonly?" readonly ":" ";return e.placeholder=e.placeholder?e.placeholder:"",{markup:'<label for="textarea-'+e.name+'" class="col-sm-2">'+e.title+" "+(e.require?'<span class="require">*</span>':"")+'</label><div class="col-sm-10"><textarea '+t+n+' id="textarea-'+e.name+'" class="form-control" rows="4" placeholder="'+e.placeholder+'" data-ng-model="form.'+e.name+'"></textarea></div>',callback:function(e){return!0}}}function TextMarkup(e){var t="undefined"!=typeof e.disabled&&1==e.disabled?" disabled ":" ",n="undefined"!=typeof e.readonly&&1==e.readonly?" readonly ":" ";return e.placeholder=e.placeholder||"",{markup:'<label for="text-'+e.name+'" class="col-sm-2">'+e.title+" "+(e.require?'<span class="require">*</span>':"")+'</label><div class="col-sm-10"><textarea '+t+n+' autocomplete="off" id="text-'+e.name+'" placeholder="'+e.placeholder+'" class="form-control" rows="4" data-ng-model="form.'+e.name+'"></textarea></div>',callback:function(e){return!0}}}function StringMarkup(e){var t="undefined"!=typeof e.disabled&&1==e.disabled?" readonly ":" ",n="undefined"!=typeof e.readonly&&1==e.readonly?" readonly ":" ";return e.placeholder=e.placeholder?e.placeholder:"",{markup:'<label for="'+e.name+'" class="col-sm-2">'+e.title+" "+(e.require?'<span class="require">*</span>':"")+'</label><div class="col-sm-10"><input '+t+n+' autocomplete="off" id="'+e.name+'" placeholder="'+e.placeholder+'" type="text" class="form-control" data-ng-model="form.'+e.name+'"></div>',callback:function(e){return!0}}}function SpeedMarkup(e){var t="undefined"!=typeof e.disabled&&1==e.disabled||e.readonly?" disabled ":" ";return{markup:'<label for="select-'+e.name+'" class="col-sm-2">'+e.title+" "+(e.require?'<span class="require">*</span>':"")+'</label><div class="col-sm-10"><span ><select '+t+' class="chosen-select" data-ng-options="o for  o in speedList" data-ng-model="form.'+e.name+'"></select></span></div>',callback:function(e){return setTimeout(function(){jQuery(".chosen-select").chosen({})},500),!0}}}function SlidesMarkup(e){var t="undefined"!=typeof e.disabled&&1==e.disabled||e.readonly?" disabled ":" ";return{markup:['<label for="'+e.name+'" class="col-sm-2">'+e.title+" "+(e.require?'<span class="require">*</span>':"")+"</label>",'<div class="col-sm-10 slides-item" data-ng-class="{\'pull-right\': $index > 0}" data-ng-repeat="tileSlid in form.'+e.name+'">',"<input "+t+' type="file" data-index="{{$index}}" title="Выберите файл"   onchange="angular.element(this).scope().changeFile(this)"  data-file-upload class="btn-primary" data-ng-model="tileSlid.path">','<img class="image-link" data-ng-if="tileSlid.route" style="width:30px; margin-left: 18px;" data-ng-src="{{tileSlid.route}}"/>','<img class="image-link" data-ng-if="!tileSlid.route" style="width:30px; margin-left: 18px;" data-ng-src="http://placehold.it/30x30"/>','<label  title="Видимость" class="switch" style="position: relative; top: 10px; left: 10px; margin-right: 10px;"><input data-ng-model="tileSlid.status"  type="checkbox" ><i></i></label>','<a data-ng-hide="$first" data-ng-click="remTileSlide($index);" title="Удалить" href="javascript:;" style="margin-left: 10px;" class="btn-icon btn-icon-sm bg-danger"><i class="glyphicon glyphicon-minus"></i></a>','<a data-ng-show="$last" data-ng-click="addTileSlide();" title="Добавить" href="javascript:;" style="margin-left: 10px; " class="btn-icon btn-icon-sm bg-info"><i class="glyphicon glyphicon-plus"></i></a>',"</div>"].join(""),callback:function(e){return!0}}}function SelectMarkup(e){var t="undefined"!=typeof e.disabled&&1==e.disabled||e.readonly?"disabled":"";return{markup:'<label for="select-'+e.name+'" class="col-sm-2">'+e.title+" "+(e.require?'<span class="require">*</span>':"")+'</label><div class="col-sm-10"><select '+t+' chosen no_results_text="\'Результат не найден\'" placeholder-text-multiple="\'Выберите один или несколько вариантов\'" placeholder-text-single="\'Выберите один вариант\'" ng-options="option.name for option in  optionsData.'+e.name+'.options " id="select-'+e.name+'.val" ng-model="form.'+e.name+'"></select></div>',callback:function(e){return setTimeout(function(){"disabled"===t&&jQuery(e).find("[chosen]").prop("disabled",!0).trigger("chosen:updated")},500),!0}}}function PasswordMarkup(e){var t="undefined"!=typeof e.disabled&&1==e.disabled?" disabled ":" ",n="undefined"!=typeof e.readonly&&1==e.readonly?" readonly ":" ";return{markup:'<label for="'+e.name+'" class="col-sm-2">'+e.title+" "+(e.require?'<span class="require">*</span>':"")+'</label><div class="col-sm-10"><atom-password ><div class="input-group"><input '+t+n+' id="'+e.name+'"  autocomplete="off" type="{{atomPassword.type}}" class="form-control" data-ng-model="form.'+e.name+'"><span class="input-group-addon" ng-click="atomPassword.generatePassword()"><i class="glyphicon glyphicon-flash"></i></span></div></atom-password></div>',callback:function(e){return!0}}}function NumericMarkup(e){var t="undefined"!=typeof e.disabled&&1==e.disabled?" disabled ":" ",n="undefined"!=typeof e.readonly&&1==e.readonly?" readonly ":" ";return e.placeholder=e.placeholder?e.placeholder:"",{markup:'<label for="number-'+e.name+'" class="col-sm-2">'+e.title+" "+(e.require?'<span class="require">*</span>':"")+'</label><div class="col-sm-10"><input '+t+n+' id="number-'+e.name+'" placeholder="'+e.placeholder+'"  data-ng-model="form.'+e.name+'"  type="number" class="form-control"></div>',callback:function(e){return e=e.find(".input-group"),e.find(".input-group-btn  button").click(function(){setTimeout(function(){e.find("input.spinner-input").trigger("change")},300)}),!0}}}function MarkupFactory(e){if(e){"datetime"!==e&&"time"!==e||(e="date"),e=e.split("-"),angular.forEach(e,function(t,n){var a=t.charAt(0).toUpperCase();e[n]=a+t.substr(1,t.length-1)});var t=e.join("")+"Markup";return t}}function IntegerMarkup(e){var t="undefined"!=typeof e.disabled&&1==e.disabled?" disabled ":" ",n="undefined"!=typeof e.readonly&&1==e.readonly?" readonly ":" ";return{markup:'<label for="number-'+e.name+'" class="col-sm-2">'+e.title+" "+(e.require?'<span class="require">*</span>':"")+'</label><div class="col-sm-10"><input '+t+n+' id="number-'+e.name+'" data-ng-model="form.'+e.name+'"  type="number" class="form-control"></div>',callback:function(e){return e=e.find(".input-group"),e.find(".input-group-btn  button").click(function(){setTimeout(function(){e.find("input.spinner-input").trigger("change")},300)}),!0}}}function ImgMarkup(e){var t="undefined"!=typeof e.disabled&&1==e.disabled||e.readonly?" disabled ":" ";return{markup:'<label for="'+e.name+'" class="col-sm-2">'+e.title+" "+(e.require?'<span class="require">*</span>':"")+'</label><div class="col-sm-10"><input '+t+' id="'+e.name+'" type="file" title="Выберите файл"   onchange="angular.element(this).scope().changeFile(this)"  data-file-upload class="btn-primary" data-ng-model="form.'+e.name+'"><img class="image-link" data-ng-if="form.'+e.name+'" style="height:30px; margin-left: 18px;" data-ng-src="{{form.'+e.name+'}}"/></div>',callback:function(e){return!0}}}function ImageMarkup(e){var t="undefined"!=typeof e.disabled&&1==e.disabled||e.readonly?" disabled ":" ";return{markup:'<label for="'+e.name+'" class="col-sm-2">'+e.title+" "+(e.require?'<span class="require">*</span>':"")+'</label><div class="col-sm-10" atom-file><input '+t+' id="'+e.name+'" name="'+e.name+'" type="file" title="Выберите файл"  class="ng-hide"><a class="file-input-wrapper btn btn-default  btn-primary" ><span>Выберите файл</span></a><img class="image-link" data-ng-if="form.'+e.name+'[0].route" style="height:30px; margin-left: 18px;" ng-click="openLightboxModal($event)" data-ng-src="{{form.'+e.name+'[0].route}}"/></div>',callback:function(e){return!0}}}function HtmlMarkup(e){var t="undefined"!=typeof e.disabled&&1==e.disabled?" disabled ":" ",n="undefined"!=typeof e.readonly&&1==e.readonly?" readonly ":" ";return{markup:'<label for="textarea-'+e.name+'" class="col-sm-2">'+e.title+" "+(e.require?'<span class="require">*</span>':"")+'</label><div class="col-sm-10"><textarea '+t+n+' id="textarea-'+e.name+'" data-ui-tinymce class="form-control" rows="4" data-ng-model="form.'+e.name+'"></textarea></div>',callback:function(e){return!0}}}function FileMarkup(e){var t="undefined"!=typeof e.disabled&&1==e.disabled||e.readonly?" disabled ":" ";return{markup:'<label for="'+e.name+'" class="col-sm-2">'+e.title+" "+(e.require?'<span class="require">*</span>':"")+'</label><div class="col-sm-10" atom-file><input data-file-upload '+t+' id="'+e.name+'" ng-model="form.'+e.name+'" name="'+e.name+'" type="file" title="Выберите файл"  class="ng-hide"><a class="file-input-wrapper btn btn-default  btn-primary" ><span>Выберите файл</span></a></div>',callback:function(e){return!0}}}function EntityMarkup(e){var t=e.multiple===!0?" multiple ":" ",n="undefined"!=typeof e.disabled&&1==e.disabled||e.readonly?"disabled":" ";return{markup:'<label for="select-'+e.name+'" class="col-sm-2">'+e.title+" "+(e.require?'<span class="require">*</span>':"")+"<a ng-if=\"selectedEntity('"+e.name+'\')" href="javascript:void(0)" ng-click="openEntity(\''+e.name+"',"+e.multiple+')" ><i  tooltip="Открыть в новом окне связанные элементы" tooltip-placement="top" tooltip-append-to-body="true" class="fa fa-share entity-link '+t+'"></i></a></label><div class="col-sm-10"><span ><select '+n+' chosen="{disableSearch: true}" disable-search no_results_text="\'Результат не найден\'" placeholder-text-multiple="\'Выберите один или несколько вариантов\'" placeholder-text-single="\'Выберите один вариант\'" class="form-control"  '+t+' entity-markup ng-options="option as option.name for option in  ::options track by option.id" id="select-'+e.name+'.val" ng-model="form.'+e.name+'"></select></span></div>',callback:function(e){return setTimeout(function(){"disabled"===n&&jQuery(e).find("[chosen]").prop("disabled",!0).trigger("chosen:updated")},500),!0}}}function DateMarkup(e){"undefined"!=typeof e.disabled&&1==e.disabled||e.readonly?" disabled ":" ";return{markup:['<label for="'+e.name+'" class="col-sm-2">'+e.title+" "+(e.require?'<span class="require">*</span>':"")+"</label>",'<div class="input-group col-sm-4" style="padding: 0 15px;" m-model="form.'+e.name+'.sec" ng-model="form.'+e.name+'.sec" atom-datetimepicker language="ru" form="form" data-data-type="'+e.type+'" data-data-name="'+e.name+'" >',"</div>"].join(""),callback:function(e){return!0}}}function BooleanMarkup(e){var t="undefined"!=typeof e.disabled&&1==e.disabled||e.readonly?" disabled ":" ";return{markup:'<label for="'+e.name+'" class="col-sm-2">'+e.title+" "+(e.require?'<span class="require">*</span>':"")+'</label><div class="col-sm-10"><label class="switch"><input '+t+' id="'+e.name+'"  type="checkbox" data-ng-model="form.'+e.name+'" ><i></i></label></div>',callback:function(e){return!0}}}function AclMarkup(e){var t="undefined"!=typeof e.disabled&&1==e.disabled||e.readonly?" disabled ":" ";return{markup:'<label for="'+e.name+'" class="col-sm-2">'+e.title+" "+(e.require?'<span class="require">*</span>':"")+'</label><div class="col-sm-10"><div class="table-responsive"><table class="table table-striped table-bordered" acl-markup'+t+'><thead><tr><th>#</th><th width="15%">Чтение</th><th width="15%">Создание</th><th width="15%">Редактирование</th><th width="15%">Удаление</th></tr></thead><tbody><tr ng-repeat="option in optionsData.'+e.name+'.options"><td>{{option.title}}</td><td><label class="switch"><input id="read_{{ option.key }}"  type="checkbox" data-ng-model="option.read" ><i></i></label></td><td><label class="switch" ng-show="option.key != \'index\' && option.key != \'atom\'"><input id="create_{{ option.key }}"  type="checkbox" data-ng-model="option.create" ><i></i></label></td><td><label class="switch" ng-show="option.key != \'index\' && option.key != \'atom\'"><input id="update_{{ option.key }}"  type="checkbox" data-ng-model="option.update" ><i></i></label></td><td><label class="switch" ng-show="option.key != \'index\' && option.key != \'atom\'"><input id="delete_{{ option.key }}"  type="checkbox" data-ng-model="option.delete" ><i></i></label></td></tr></tbody></table></div></div>',callback:function(e){return!0}}}!function(){"use strict";angular.module("entityPage",[]).config(["$stateProvider",function(e){e.state("pagesList",{url:"/page/list",views:{"content@":{templateUrl:"app/modules/entityPage/pagesList/pagesList.html",controller:"PagesListCtrl"}}}).state("entitiesList",{url:"/:entity/list",views:{"content@":{templateUrl:"app/modules/entityPage/entitiesList/entitiesList.html",controller:"EntitiesListCtrl"}}}).state("entityEdit",{url:"/:entity/edit/:id",views:{"content@":{templateUrl:"app/modules/entityPage/entityEdit/entityEdit.html",controller:"EntityEditCtrl"}}}).state("entityAdd",{url:"/:entity/add",views:{"content@":{templateUrl:"app/modules/entityPage/entityEdit/entityEdit.html",controller:"EntityEditCtrl"}}}).state("entityAddPage",{url:"/:entity/add/:pid",views:{"content@":{templateUrl:"app/modules/entityPage/entityEdit/entityEdit.html",controller:"EntityEditCtrl"}}})}])}(),function(){"use strict";angular.module("entityPage").controller("PagesListCtrl",["$q","$log","$scope","$stateParams","$state","$location","EntityService","$uibModal","toastr","_",function(e,t,n,a,i,o,s,r,l,c){function d(e,t,n){return c.each(e,function(t){if(0!==t._id.$id){var n="undefined"!=typeof t.pid.$id?t.pid.$id:t.pid;e[n].items.push(t),e[n].items.sort(function(e,t){return e.position-t.position})}}),t}var u={};n.list=[];var p=[];n.options={dropped:function(t){function a(e){c.each(e.items,function(t){var n=t.url.split("/");t.url=e.url+n[n.length-2],i.push({_id:t._id.$id,position:t.position,pid:t.pid.$id,url:t.url}),a(t)})}var i=[],o=[],r=t.source.nodeScope.$modelValue,d=t.dest.index,m=t.source.index,g=t.dest.nodesScope.$nodeScope.$modelValue,f=t.source.nodesScope.$nodeScope.$modelValue;if(d!==m||g._id.$id!==f._id.$id){var h;h=0===r.pid?0:r.pid.$id,c.each(u[h].items,function(e){o.push({_id:e._id.$id,position:e.position,pid:e.pid.$id,url:e.url})}),r.pid=g._id,c.each(u[r.pid.$id].items,function(e,t){o.push({_id:e._id.$id,position:e.position,pid:e.pid.$id,url:e.url}),e.position=t;var n=e.url.split("/");e.url=g.url+n[n.length-2]+"/",i.push({_id:e._id.$id,position:e.position,pid:e.pid.$id,url:e.url}),a(e)});var y=[];c.each(i,function(e){y.push(s.saveEntity("page",e,!1,!1))}),e.all(y).then(function(e){var t=!0;c.each(e,function(e){t=t||e.data.success}),t&&(l.success("Изменения успешно сохранены"),p=c.clone(n.data))},function(t){c.each(t.data.error,function(e){c.each(e,function(e){l.error(e.message)})});var a=[];c.each(o,function(e){a.push(s.saveEntity("page",e,!1,!1))}),e.all(a).then(function(e){n.data=p})})}}},s.getEntityDescription("page").then(function(e){s.getEntityPage("page",0,0).then(function(t){c.each(t.data.data,function(e){e.items=[],u[e._id.$id]=e});var a={_id:{$id:0},items:[],title:o.host(),url:"/",isRoot:!0};u[0]=a,a=d(u,a,0),n.data=[a],p=c.clone(n.data),n.list.scheme=e.data.page.scheme})}),n.removeItem=function(e,t){var n=e._id.$id,a=e.title,i=r.open({templateUrl:"app/components/popup/popup.html",controller:["$scope",function(o){o.title=a,o.message="Вы действительно хотите удалить данный элемент?",o.ok=function(){i.close(),s.removeEntity("page",{_id:n}).then(function(){l.success("Запись успешно удалена")}),t(e)},o.cancel=function(){i.dismiss("cancel")}}]})},n.toggle=function(e){e.collapsed=!e.collapsed},n.hoverIn=function(){this.hovered=!0},n.hoverOut=function(){this.hovered=!1}}])}(),function(){"use strict";angular.module("entityPage").controller("EntityEditCtrl",["$scope","$state","$stateParams","$uibModal","$window","$q","EntityService","AuthService","_","uiTinymceConfig","toastr","$cookies",function(e,t,n,a,i,o,s,r,l,c,d,u){var p={};e.form={},e.entity=n.entity,e.isNew=!n.id,e.itemTitle="",i.jQuery.ajaxSetup({beforeSend:function(e){e.setRequestHeader("Token",u.get("token"))}}),c=l.extend(c,{height:300,menubar:!1,language:"ru",plugins:["code,table advlist autolink link image lists charmap print preview hr anchor pagebreak ","searchreplace wordcount visualblocks visualchars insertdatetime media nonbreaking"," contextmenu directionality emoticons paste textcolor responsivefilemanager"],convert_urls:!1,relative_urls:!0,toolbar1:"formatselect | bold italic underline | alignleft aligncenter alignright alignjustify | outdent indent | bullist numlist | table | styleselect| link unlink filemanager | image media | code ",valid_elements:"*[*]",image_advtab:!0,external_filemanager_path:"/atom/filemanager/",external_plugins:{filemanager:"/themes/backend/filemanager/plugin.min.js"},filemanager_title:"Файловый менеджер"}),o.all([r.properties(),s.getEntityDescription(n.entity)]).then(function(t){function a(){var t="undefined"==typeof e.backend.tabs.main?"default":"main";return"default"===t&&(e.backend.tabs[t]="Основное",c[t]="Основное"),t}var i=t[1],o=t[0].data.entities[n.entity];e.updateEnabled="undefined"!=typeof i.data[n.entity].routes[n.entity+".update"],e.deleteEnabled="undefined"!=typeof i.data[n.entity].routes[n.entity+".delete"];var r=i.data[n.entity].scheme;e.backend={},e.backend.tabs=o.tabs||{};var c={};l.each(r,function(t){"undefined"==typeof t.tab&&(t.tab=a()),"undefined"==typeof e.backend.tabs[t.tab]&&(e.backend.tabs[t.tab]=t.tab)}),l.each(e.backend.tabs,function(t,n){l.each(r,function(t){t.tab===n&&(c[t.tab]=e.backend.tabs[t.tab])})}),e.tabsCount=l.keys(c).length,e.tabs=c,n.id?s.getEntity(n.entity,n.id).then(function(t){e.form={},e.optionsData={},l.each(r,function(n,a){"select"==n.type||"entity"==n.type||"acl"==n.type?(e.optionsData[a]=n,e.optionsData[a].options=[],e.form[a]=n.multiple?[]:null,"select"==n.type?l.each(n.values,function(i,o){var s={name:i,id:o};e.optionsData[a].options.push(s),o==t.data.data[0][a]&&(n.multiple?e.form[a].push(s):e.form[a]=s)}):e.optionsData[a].sourceValues=t.data.data[0][a]):e.form[a]=t.data.data[0][a],n.name=a}),e.formSchema=r,l.each(e.formSchema,function(n,a){if("undefined"==typeof e.form[a]?e.form[a]=n["default"]:"undefined"==typeof e.form[a]&&"select"==n.type&&l.each(n.values,function(i,o){var s={name:i,id:o};e.optionsData[a].options.push(s),o==t.data.data[0][a]&&(n.multiple?e.form[a].push(s):e.form[a]=s)}),"url"==n.type){var i=e.form[a],o=(e.form.title,i.split("/")),s=i.substring(0,i.length-o[o.length-2].length-1),r=o[o.length-2];e.form[a]={urlPrefix:s,displayUrl:r}}}),p=l.clone(e.form),e.itemTitle=e.form.title}):(e.optionsData={},l.each(r,function(t,n){"boolean"===t.type?"undefined"!=typeof t["default"]?e.form[n]=t["default"]:e.form[n]=!1:"entity"===t.type||"select"===t.type||"acl"==t.type?(e.optionsData[n]=t,e.optionsData[n].options=[],e.optionsData[n].sourceValues={},e.form[n]=t.multiple?[]:null,"select"==t.type&&l.each(t.values,function(a,i){var o={name:a,id:i};e.optionsData[n].options.push(o),o.id==t["default"]&&(t.multiple?e.form[n].push(o):e.form[n]=o)})):"undefined"==typeof t["default"]?e.form[n]=null:e.form[n]=t["default"],t.name=n}),n.pid?"0"===n.pid?(e.form.url={urlPrefix:"/",displayUrl:""},e.optionsData.pid=r.pid,e.optionsData.pid.sourceValues={$id:"0"},e.formSchema=r,p=l.clone(e.form)):s.getEntity(n.entity,n.pid).then(function(t){e.form.url={urlPrefix:t.data.data[0].url,displayUrl:""},e.optionsData.pid=r.pid,e.optionsData.pid.sourceValues=t.data.data[0]._id,e.formSchema=r,p=l.clone(e.form)}):(e.formSchema=r,p=l.clone(e.form)))}),e.save=function(t){n.id&&(e.form._id=n.id);var a={},o=!!l.findWhere(e.formSchema,{type:"image"})||!!l.findWhere(e.formSchema,{type:"file"}),r=new i.FormData;l.each(e.form,function(t,n){("_id"==n||"undefined"!=typeof t&&null!==t||"acl"===e.formSchema[n].type)&&("_id"==n||"entity"!=e.formSchema[n].type&&"select"!=e.formSchema[n].type?"_id"!=n&&"acl"==e.formSchema[n].type?l.each(e.formSchema[n].options,function(e,t){a[n+"["+e.key+"][read]"]=e.read||!1,a[n+"["+e.key+"][create]"]=e.create||!1,a[n+"["+e.key+"][update]"]=e.update||!1,a[n+"["+e.key+"][delete]"]=e["delete"]||!1}):"_id"!=n&&"image"==e.formSchema[n].type?t&&t.updateFile&&r.append(n,t):"_id"!=n&&"file"==e.formSchema[n].type?t&&t.updateFile&&r.append(n,t):"_id"!=n&&"url"==e.formSchema[n].type?(t=e.form[n].urlPrefix+e.form[n].displayUrl+"/",a[n]=t,r.append(n,t)):(a[n]=t,r.append(n,t)):e.formSchema[n].multiple?l.each(t,function(e,t){a[n+"["+t+"]"]=e.id,r.append(n+"["+t+"]",e.id)}):t&&"undefined"!=typeof t.id&&(r.append(n,t.id),a[n]=t.id))}),s.saveEntity(n.entity,o?r:a,e.isNew,o).then(function(n){n.data.success&&(d.success("Запись успешно сохранена"),t?e.goToList():e.goToEdit(l.keys(n.data.success[0])))},function(e){l.each(e.data.error,function(e){l.each(e,function(e){d.error(e.message)})})})},e.remove=function(){var i=e.form.title||null,o=a.open({templateUrl:"app/components/popup/popup.html",controller:["$scope",function(e){e.title=i,e.message="Вы действительно хотите удалить данный элемент?",e.ok=function(){o.close(),s.removeEntity(n.entity,{_id:n.id}).then(function(){d.success("Запись успешно удалена"),t.go("entitiesList",{entity:n.entity})})},e.cancel=function(){o.dismiss("cancel")}}]})},e.clear=function(){for(var t in e.form)e.form[t]=null},e.rollback=function(){e.form=l.clone(p)},e.goToList=function(){t.go("page"===n.entity?"pagesList":"entitiesList",{entity:n.entity})},e.goToEdit=function(e){t.go("entityEdit",{entity:n.entity,id:e})},e.openEntity=function(n,a){var o=e.form[n];if(0!==o.length){var s;void 0===a||0==a?(s=t.href("entityEdit",{entity:e.formSchema[n].entity.model,id:o.id},{absolute:!1}),i.open(location.origin+location.pathname+s)):l.each(o,function(a){s=t.href("entityEdit",{entity:e.formSchema[n].entity.model,id:a.id},{absolute:!1}),i.open(location.origin+location.pathname+s)})}},e.selectedEntity=function(t){return null!==e.form[t]&&0!=e.form[t].length}}])}(),function(){"use strict";angular.module("entityPage").controller("EntitiesListCtrl",["$log","$q","$scope","$stateParams","$state","$timeout","EntityService","$uibModal","toastr","_","SessionService","deviceDetector",function(e,t,n,a,i,o,s,r,l,c,d,u){function p(){o(function(){var e=!1;e="safari"==u.browser?angular.element("#content div.panel-body").outerWidth()>angular.element("section.table-flip-scroll").width():angular.element("#content table").width()>angular.element("section.table-flip-scroll").width(),e&&(angular.element("section.panel div.panel-body").css("max-height",angular.element(window).height()-(angular.element("#header").height()+(angular.element("div.page").innerHeight()-angular.element("div.page").height()-110)+angular.element("div.panel-heading").outerHeight(!0)+angular.element("div.table-filters").outerHeight(!0)+angular.element("footer.table-footer").outerHeight(!0))+"px"),angular.element("section.panel div.panel-body").css("overflow-y","auto"))},500)}if("page"==a.entity)return void i.go("pagesList");var m=d.getEntityListState(a.entity)||{};n.$log=e,n.list={},n.model=a.entity,n.remList=[],n.linkedEntities={};var g={},f=[],h=!1,y=[],b={},v=[];n.curSortField=m.curSortField,n.curSortOrder=m.curSortOrder,n.searchKeywords=m.searchKeywords,n.hasSearchFields=!1,n.order=function(e,t){n.curSortField=e,n.curSortOrder=t,f=[],n.remList=[],m.curSortField=e,m.curSortOrder=t,d.setEntityListState(m,a.entity),n.displayData(0,n.perPage,n.curSortField,n.curSortOrder,n.searchKeywords)},s.getEntityDescription(a.entity).then(function(e){n.exportEnabled="undefined"!=typeof e.data[a.entity].routes[a.entity+".export"],n.createEnabled="undefined"!=typeof e.data[a.entity].routes[a.entity+".create"],n.deleteEnabled="undefined"!=typeof e.data[a.entity].routes[a.entity+".delete"],n.editEnabled="undefined"!=typeof e.data[a.entity].routes[a.entity+".update"],n.list.scheme=e.data[a.entity].scheme;for(var t in n.list.scheme)n.list.scheme[t].sort&&v.push(t),n.list.scheme[t].search&&(n.hasSearchFields=!0),"entity"==n.list.scheme[t].type&&n.list.scheme[t].sort&&(y[t]=[],b[t]=n.list.scheme[t].entity&&n.list.scheme[t].entity.model?n.list.scheme[t].entity.model:t,g[t]=n.list.scheme[t].entity||{});n.displayData(0,n.perPage,n.curSortField,n.curSortOrder,n.searchKeywords)}),n.displayData=function(e,i,o,r,l){n.renderData=null,s.getEntityPage(a.entity,e,i,o,r,l,v).then(function(e){if(h=!1,204!=e.status){for(var a=[],i=0;i<e.data.data.length;i++)a.push(e.data.data[i]);c.each(e.data.data,function(e){c.each(c.keys(y),function(t){"undefined"!=typeof e[t]&&y[t].push(e[t])})});var o=[],r=[];c.each(c.keys(y),function(e){if("pid"!=e){var t=s.getLinkedEntities(b[e],g[e].field,c.uniq(y[e]));o=o.concat(t);for(var n=0;n<t.length;n++)r.push(e)}}),t.all(o).then(function(t){t=c.zip(t,r);var i=[];c.each(t,function(e){i[e[1]]&&i[e[1]][0].data.data?i[e[1]][0].data.data=i[e[1]][0].data.data.concat(e[0].data.data):i[e[1]]=e}),t=[];for(var o in i)t.push(i[o]);c.each(t,function(e){n.linkedEntities[e[1]]=[];var t=c.compact(e[0].data.data);c.each(t,function(t){n.linkedEntities[e[1]].push({$id:t._id.$id,title:g[e[1]]?t[g[e[1]].field]:t.title})})}),n.renderData=a,n.$broadcast("dataCountReady",e.data.total)}),0==c.keys(y).length&&(n.renderData=a)}else n.renderData=[],n.$broadcast("dataCountReady",0)})},n.$on("dataCountReady",p),angular.element(window).resize(p),n["new"]=function(){i.go("entityAdd",{entity:n.model})},n.setEdited=function(e){s.saveEntity(a.entity,{_id:e._id.$id,enabled:e.enabled}).then(function(e){e.data.success&&l.success("Запись сохранена")})},n.selectAllItems=function(e){n.remList=[];var t=angular.element(e.currentTarget),a=t.closest("table");a.find('tbody input[type="checkbox"].remBox').prop("checked",t.is(":checked")),1==e.currentTarget.checked?angular.forEach(a.find('tbody input[type="checkbox"].remBox'),function(e){n.remList.push(e.value)}):n.remList=[],f=n.remList},n.updateRemItems=function(e){if(e.currentTarget.checked===!1){var t=c.indexOf(n.remList,e.currentTarget.value);t>-1&&n.remList.splice(t,1)}else n.remList.push(e.currentTarget.value);f=n.remList},n.isSelectItems=function(){return 0===n.remList.length},n.exportStack=function(){s.exportEntity(a.entity,f,n.curSortField,n.curSortOrder,n.searchKeywords)},n.deleteStack=function(e){var t=n.renderData,o=r.open({templateUrl:"app/components/popup/popup.html",controller:["$scope",function(n){var r=e?[e]:f;if(r.length>1)n.title="Всего выбрано элементов: "+r.length;else{var d=c.find(t,function(e){return e._id.$id==r[0]});n.title=d.title||null}n.message=r.length>1?"Вы действительно хотите удалить данные элементы?":"Вы действительно хотите удалить данный элемент?",n.ok=function(){o.close(),c.each(r,function(e){s.removeEntity(a.entity,{_id:e}).then(function(){l.success("Запись успешно удалена"),i.transitionTo(i.current,a,{reload:!0,inherit:!1,notify:!0})})})},n.cancel=function(){o.dismiss("cancel")}}]})},n.search=function(){m.searchKeywords=n.searchKeywords,d.setEntityListState(m,a.entity),n.displayData(0,n.perPage,n.curSortField,n.curSortOrder,n.searchKeywords)},n.keyUpHandler=function(e){13===e.keyCode&&n.search()}}])}(),function(){"use strict";angular.module("components.entity",[]).config(["$provide",function(e){e.decorator("EntityService",["$delegate","EntityServiceMock","debug",function(e,t,n){return n&&(e=t),e}])}])}(),function(){"use strict";angular.module("components.entity").service("EntityServiceMock",["$http","$httpParamSerializer",function(e,t){this.getEntities=function(){return e.get("/app/rest/entity/fixture/entities.json")},this.getEntitiesList=function(t){return e.get("/app/rest/entity/fixture/usersList.json")},this.getEntityDescription=function(t){return e.get("/app/rest/entity/fixture/usersDescription.json")},this.getEntityPage=function(t,n,a){return 0===n?e.get("/app/rest/entity/fixture/usersPage1.json"):e.get("/app/rest/entity/fixture/usersPage2.json")},this.getEntity=function(t,n){return e.get("/app/rest/entity/fixture/userExample.json")},this.saveEntity=function(n,a){return e.get("/app/rest/entity/fixture/userSaved.json",t(a))},this.removeEntity=function(n,a){return e.get("/app/rest/entity/fixture/userSaved.json",t(a))}}])}(),function(){"use strict";angular.module("components.entity").service("EntityService",["$http","$httpParamSerializer","baseURL","_",function(e,t,n,a){var i=this;this.getEntities=function(t){var a=t?"?condition[name]="+t:"";return e.get(n+"/atom/entities/"+a)},this.getEntitiesList=function(t,a,i,o){a=a||0;var s=o?"&fields[]="+o:"",r="";if(angular.isObject(i))for(var l in i)r+="&sort["+l+"]="+i[l];return e.get(n+"/"+t+"/?condition[enabled][$ne]=null&limit="+a+r+s)},this.getEntityDescription=function(e){return i.getEntities(e)},this.getEntityPage=function(t,a,i,o,s,r,l){var c=o&&s?"&sort["+o+"]="+s:"",d=r?"&condition[$query]="+r+"&condition[ref_entity]="+t:"",u=l&&l.length?"&fields[]="+l.join("&fields[]="):"";return d?e.get(n+"/search/page/"+a+"/?condition[enabled][$ne]=null&limit="+i+c+u+d):e.get(n+"/"+t+"/page/"+a+"/?condition[enabled][$ne]=null&limit="+i+c+u)},this.getEntity=function(t,a){return e.get(n+"/"+t+"/"+a+"/")},this.saveEntity=function(a,i,o,s){var r="undefined"==typeof i._id&&o?"create":"update";return s?e.post(n+"/"+a+"/"+r+"/",i,{headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":void 0,Accept:"application/json"}}):e.post(n+"/"+a+"/"+r+"/",t(i))},this.removeEntity=function(a,i){return e.post(n+"/"+a+"/delete/",t(i))},this.exportEntity=function(e,t,n,i,o){var s=[];if(t.length)for(var r=0;r<t.length;r++)s.push(angular.element('<input type="hidden" name="condition[_id][$in][]" value="'+t[r]+'">'));var l=angular.element("#downloadForm");l.html("");var c=angular.element('<input type="hidden" name="limit" value="0">'),d=n&&i?angular.element('<input type="hidden" name="sort['+n+']" value="'+i+'">'):"",u=o?angular.element('<input type="hidden" name="condition[$search]" value="'+o+'">'):"";a.each(s,function(e){l.append(e)}),l.append(c),l.append(d),l.append(u),l.attr({action:"/"+e+"/export/"})[0].submit()},this.getLinkedEntities=function(t,a,i){var o=[],s=[];if(i.length){var r,l;for(r=0,l=0;r<i.length;r++,l++)i[r]&&o.push("condition[_id][$in][]="+i[r].$id),19!=l&&r!=i.length-1||(o=o.join("&"),s.push(e.get(n+"/"+t+"/?"+o+"&limit=0")),l=-1,o=[])}return s}}])}(),function(){"use strict";angular.module("components.auth",[]).config(["$provide",function(e){e.decorator("AuthService",["$delegate","$location","AuthServiceMock","debug",function(e,t,n,a){return console.log("debug",a),a&&(e=n),e}])}])}(),function(){"use strict";angular.module("components.auth").service("AuthServiceMock",["$http",function(e){this.logout=function(){return e.get("/app/rest/auth/fixture/logout_success.json")},this.login=function(t){var n=0===t.email.indexOf("test")?"auth.json":"auth_fail.json";return e.get("/app/rest/auth/fixture/"+n)},this.properties=function(){return e.get("/app/rest/auth/fixture/properties.json")}}])}(),function(){"use strict";angular.module("components.auth").service("AuthService",["$http","$httpParamSerializer","$q","baseURL",function(e,t,n,a){var i=this;i.cache={},this.logout=function(){return e.get(a+"/user/logout/")},this.login=function(n){return e.post(a+"/user/auth/pass/",t(n))},this.properties=function(){return i.cache.properties?n.when(i.cache.properties):e.get(a+"/atom/properties/").then(function(e){return i.cache.properties=e,e})}}])}(),function(){"use strict";angular.module("errorPage",[]).config(["$stateProvider",function(e){e.state("error500",{views:{"content@":{templateUrl:"app/modules/errorPage/500.html",controller:"ErrorPageCtrl"
}}})}])}(),function(){"use strict";angular.module("errorPage").controller("ErrorPageCtrl",["$scope","$rootScope",function(e,t){t.hidePanels=!0,e.closeError=function(){t.hidePanels=!1}}])}(),function(){"use strict";angular.module("dashboard",["components.session","components.auth"]).config(["$stateProvider",function(e){e.state("dashboard",{url:"/",views:{"content@":{templateUrl:"app/modules/dashboard/dashboard.html",controller:"DashboardCtrl"}}})}])}(),function(){"use strict";angular.module("dashboard").controller("DashboardCtrl",["$state","$cookies","$rootScope",function(e,t,n){if(n.authorized){var a=t.get("homepage");e.go("entitiesList",{entity:a})}}])}(),function(){"use strict";angular.module("authorization",["components.session","components.auth"]).config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/"),e.state("login",{url:"/login",views:{"content@":{templateUrl:"app/modules/authorization/authorization.html",controller:"AuthorizationCtrl"}}}).state("logout",{url:"/logout",views:{"content@":{templateUrl:"app/modules/authorization/authorization.html",controller:"AuthorizationCtrl"}}})}])}(),function(){"use strict";angular.module("authorization").controller("AuthorizationCtrl",["$scope","$rootScope","$state","$document","$http","$cookies","AuthService","toastr","SessionService","$stateParams","loginPeriod",function(e,t,n,a,i,o,s,r,l,c,d){var u=31536e6;e.rememberMe=!0,n.is("logout")&&(t.hidePanels=!0,t.authorized=!1,void 0!==l.getSessionID()&&(l.setSessionID(void 0),o.remove("token"),o.remove("rememberMe"),s.logout()),n.go("login")),e.makeLogin=function(){s.login(e.user).then(function(e){return e.data.success?(i.defaults.headers.common.Token=e.data.success.user.token,s.properties().then(function(t){return{response:e,properties:t}})):void r.error(e.data.error.message)}).then(function(i){var s=i.response,c=i.properties.data.homepage,p=new Date,m={path:"/"};e.rememberMe?p.setTime(p.getTime()+u):p.setTime(p.getTime()+d),m.expires=p,l.setSessionID(s.data.success.user.token,p),l.setUserID(s.data.success.user._id.$id,p),r.success(s.data.success.message),a.find(".body-wide").removeClass("body-wide").removeClass("body-lock"),t.authorized=!0,t.hidePanels=!1,t.userName=s.data.success.user.name,o.put("token",s.data.success.user.token,m),o.put("homepage",c,m),o.put("rememberMe",e.rememberMe?1:0,m),n.go("entitiesList",{entity:c})})}}])}(),function(){"use strict";angular.module("components.siteHeader",["components.session"])}(),function(){"use strict";angular.module("components.siteHeader").directive("siteHeader",["$state","SessionService",function(e,t){return{restrict:"EA",scope:!0,templateUrl:"app/components/siteHeader/siteHeader.html",controller:["$scope",function(n){n.notifications=0,n.ques=0,n.userName="Fake",n.showMenu=!1,n.isAuthorized=function(){return!!t.getSessionID()},n.goToSearch=function(){e.go("customerSearch")}}]}}])}(),function(){"use strict";angular.module("components.session",[]).value("Session",{})}(),function(){"use strict";angular.module("components.session").service("SessionService",["$cookies","Session",function(e,t){this.getUserID=function(){return e.get("userId")},this.setUserID=function(t,n){var a=new Date;return n=n||a.getTime()+108e5,a.setTime(n),e.put("userId",t,{expires:a})},this.setSessionID=function(t,n){var a=new Date;return n=n||a.getTime()+108e5,a.setTime(n),e.put("sessionId",t,{expires:a})},this.getSessionID=function(){return e.get("sessionId")},this.setEntityListState=function(t,n){return e.putObject("entity_"+n,t)},this.getEntityListState=function(t){return e.getObject("entity_"+t)}}])}(),function(){"use strict";angular.module("components.popup",[])}(),function(){"use strict";angular.module("components.popup").directive("confirmDelete",function(){return{restrict:"EA",transclude:!0,scope:!0,templateUrl:"app/components/popup/popup.html",controller:["$scope",function(e){}]}})}(),function(){"use strict";angular.module("components.popup").controller("ModalRemoveCtrl",["$scope","$stateParams","$modalInstance",function(e,t,n){e.ok=function(){EntityService.removeEntity(t.entity,e.form),n.dismiss("cancel")},e.cancel=function(){n.dismiss("cancel")}}])}(),function(){"use strict";angular.module("components.pagination",[])}(),function(){"use strict";angular.module("components.pagination").directive("atomPagination",function(){return{restrict:"E",scope:!0,templateUrl:"app/components/pagination/pagination.html",controller:["$scope",function(e){e.scrollConfig={scrollX:"bottom",scrollY:"none",useBothWheelAxes:!0},e.numPerPageOpt=[{value:10,title:10},{value:20,title:20},{value:50,title:50},{value:100,title:100},{value:0,title:"Все"}],e.curPage=0,e.perPage=e.numPerPageOpt[2],e.$parent.perPage=e.perPage.value,e.pagesCount=0,e.itemsCount=0;e.$on("dataCountReady",function(t,n){e.itemsCount=n,e.pagesCount=e.perPage.value>0?Math.ceil(e.itemsCount/e.perPage.value):1,e.pagesCountList=e.pagesList(),e.pagesList(),e.$emit("content.changed")}),e.onNumPerPageChange=function(){e.curPage=0,e.$parent.perPage=e.perPage.value,e.pagesCount=e.perPage.value>0?Math.ceil(e.itemsCount/e.perPage.value):1,e.pagesCountList=e.pagesList(),e.displayData(e.curPage,e.perPage.value,e.curSortField,e.curSortOrder,e.searchKeywords)},e.goToPage=function(t){t>=0&&t<e.pagesCount&&(e.curPage=t,e.displayData(e.curPage,e.perPage.value,e.curSortField,e.curSortOrder,e.searchKeywords))},e.prevPage=function(t){return t?(e.goToPage(0),!1):void(e.curPage>0&&e.goToPage(e.curPage-1))},e.nextPage=function(t){return t?(e.goToPage(e.pagesCount-1),!1):void(e.curPage<e.pagesCount-1&&e.goToPage(e.curPage+1))},e.noPrevious=function(){return e.curPage<=0},e.noNext=function(){return e.curPage+1>=e.pagesCount},e.isActive=function(t){return e.curPage==t},e.pagesList=function(){var t=[];if(e.pagesCount>0)for(var n=1;n<=e.pagesCount;n++)t.push(n);return t.length?t:[1]},e.isInRange=function(t){e.pagesCount;return!0}}]}})}(),function(){"use strict";angular.module("components.navbar",["components.session"])}(),function(){"use strict";angular.module("components.navbar").directive("navbar",["SessionService",function(e){return{restrict:"EA",scope:!0,templateUrl:"app/components/navbar/navbar.html",controller:["$scope","$state","$element","AuthService",function(e,t,n,a){e.pages=[],n.find(".infoblockMenu ul").show(),a.properties().then(function(t){var n=_.clone(t.data.entities);e.pages=_.chain(n).each(function(e,t){e.entityName=t}).sortBy(function(e){return e.position}).value()})}]}}])}(),function(){"use strict";angular.module("components.helper",[])}(),function(){"use strict";angular.module("components.helper").service("HelperService",function(){var e=this;return e.stripTags=function(e){return e.replace(/<\/?[^>]+>/gi,"")},e})}(),function(){"use strict";angular.module("components.collapseNav",[])}(),function(){"use strict";angular.module("components.collapseNav").directive("collapseNav",["SessionService",function(e){return{restrict:"A",link:function(e,t,n){var a,i,o,s,r,l,c,d,u,p;return c=$(window),s=t.find("ul").parent("li"),s.append('<i class="fa fa-angle-down icon-has-ul-h"></i><i class="fa fa-angle-right icon-has-ul"></i>'),a=s.children("a"),r=t.children("li").not(s),i=r.children("a"),o=$("#app"),l=$("#nav-container"),a.on("click",function(e){var t,n;return o.hasClass("nav-collapsed-min")||l.hasClass("nav-horizontal")&&c.width()>=768?!1:(n=$(this),t=n.parent("li"),s.not(t).removeClass("open").find("ul").slideUp(),t.toggleClass("open").find("ul").stop().slideToggle(),e.preventDefault())}),i.on("click",function(e){return s.removeClass("open").find("ul").slideUp()}),e.$on("nav:reset",function(e){return s.removeClass("open").find("ul").slideUp()}),d=void 0,u=c.width(),p=function(){var e;return e=c.width(),768>e&&o.removeClass("nav-collapsed-min"),768>u&&e>=768&&l.hasClass("nav-horizontal")&&s.removeClass("open").find("ul").slideUp(),u=e},c.resize(function(){return setTimeout(p,300)})}}}])}(),function(){"use strict";angular.module("components.buildFormMarkup",[])}(),function(){"use strict";angular.module("components.buildFormMarkup").directive("buildFormMarkup",["$compile",function(e){var t={restrict:"A",link:function(n,a,i){if(i.markupData){var o=JSON.parse(i.markupData);"true"==i.fieldReadonly&&(o.readonly=!0);var s=MarkupFactory(o.type);"function"==typeof window[s]&&(t=window[s](o))&&(a.html(e(t.markup)(n)),t.callback(a))}return!0}};return t}])}(),function(){"use strict";angular.module("components.atomPassword",[])}(),function(){"use strict";angular.module("components.atomPassword").directive("atomPassword",["SessionService",function(e){return{restrict:"AE",transclude:!0,template:"<span ng-transclude></span>",link:function(e){e.atomPassword={type:"password",generatePassword:function(){e.atomPassword.type="text",e.form[e.key]=Math.random().toString(36).slice(-8)}}}}}])}(),function(){"use strict";angular.module("components.atomFile",[])}(),function(){"use strict";angular.module("components.atomFile").directive("atomFile",["SessionService",function(e){return{restrict:"A",controller:["$scope","$element","Lightbox",function(e,t,n){t.find("a").click(function(e){t.find("input").trigger("click")}),t.find("input").change(function(){var n=t.find("input")[0].files;e.form[t.find("input").attr("name")]=n[0],e.form[t.find("input").attr("name")].updateFile=!0}),e.openLightboxModal=function(e){n.openModal([{url:e.target.src,caption:"",thumbUrl:""}],0)}}]}}])}(),function(){"use strict";angular.module("components.entityMarkup",[])}(),function(){"use strict";angular.module("components.entityMarkup").directive("entityMarkup",function(){return{restict:"AE",controller:["$scope","EntityService","_",function(e,t,n){e.optionsData[e.key].options=[];var a=[],i=e.field.entity.field||"title";t.getEntitiesList(e.optionsData[e.key].entity.model,null,e.optionsData[e.key].entity.sort,i).then(function(t){e.form[e.key]=[],n.each(t.data.data,function(t){var o={name:t[i],id:t._id.$id};a.push(o),e.optionsData[e.key].multiple?n.find(e.optionsData[e.key].sourceValues,function(e){return e.$id==o.id})&&e.form[e.key].push(o):(e.optionsData[e.key].sourceValues&&!n.isEmpty(e.optionsData[e.key].sourceValues)||!e.optionsData[e.key]["default"]||e.optionsData[e.key]["default"].$id!==o.id||(e.form[e.key]=o),e.optionsData[e.key].sourceValues&&e.optionsData[e.key].sourceValues.$id==o.id&&(e.form[e.key]=o))}),e.options=a})}]}})}(),function(){"use strict";angular.module("components.entityMarkup").directive("entityListMarkup",function(){return{restict:"AE",scope:{entity:"=",entityName:"=",field:"="},template:function(){return'<span ng-if="!file && !img" style="{white-space: nowrap}">{{title}}</span><img ng-if="!file && img" ng-src="{{title}}" ng-click="openLightboxModal($event)"><a ng-if="file && !img" href="{{route}}">{{title}}</a>'},controller:["$scope","$filter","EntityService","Lightbox","HelperService",function(e,t,n,a,i){switch(e.field.type){case"date":e.title=t("date")(1e3*e.entity.sec,"dd.MM.yyyy");break;case"datetime":e.title=t("date")(1e3*e.entity.sec,"dd.MM.yyyy HH:mm");break;case"time":e.title=t("date")(1e3*e.entity.sec,"HH:mm");break;case"select":e.title=e.field.values[e.entity];break;case"entity":_.each(e.$parent.linkedEntities[e.entityName],function(t){t&&e.entity&&t.$id==e.entity.$id&&(e.title=t.title)});break;case"boolean":e.title=e.entity?"Да":"Нет";break;case"image":e.title=e.entity&&"undefined"!=typeof e.entity[0]?e.entity[0].route:"",e.img=!0;break;case"file":e.title=e.entity&&"undefined"!=typeof e.entity[0]?e.entity[0].title:"",e.route=e.entity&&"undefined"!=typeof e.entity[0]?e.entity[0].route:"",e.file=!0;break;default:e.title=i.stripTags(e.entity)}e.openLightboxModal=function(e){a.openModal([{url:e.target.src,caption:"",thumbUrl:""}],0)}}]}})}(),function(){"use strict";angular.module("components.atomDatetimepicker",[])}(),function(){"use strict";angular.module("components.atomDatetimepicker").directive("atomDatetimepicker",function(){return{restrict:"AEC",scope:{pick12HourFormat:"@",language:"@",useCurrent:"@",location:"@",mode:"@",form:"=",mModel:"=",dataName:"@dataName",dataType:"@dataType"},templateUrl:"app/components/atomDatetimepicker/atomDatetimepicker.html",link:function(e,t,n){function a(){var n=moment(t.find("input").val(),i);e.form[e.dataName]=n.toString().replace(/( \((.+)\))/g,""),t.find("input").trigger("input")}var i="time"===e.dataType?"HH:mm":"date"===e.dataType?"DD.MM.YYYY":"DD.MM.YYYY HH:mm";e.today=function(){return e.dt=new Date,e.dt},e.form.hasOwnProperty(e.dataName)&&e.form[e.dataName]?e.dt=moment(1e3*e.form[e.dataName].sec):e.today(),t.datetimepicker({locale:e.language,useCurrent:e.useCurrent,defaultDate:e.dt,format:i,extraFormats:[i],tooltips:{today:"Сегодня",clear:"Очистить",close:"Закрыть",selectMonth:"Выбрать месяц",prevMonth:"Предыдущий месяц",nextMonth:"Следующий месяц",selectYear:"Выбрать год",prevYear:"Предыдущий год",nextYear:"Следующий год",selectDecade:"Выбрать декаду",prevDecade:"Пердыдущая декада",nextDecade:"Следующая декада",prevCentury:"Предыдущее столетье",nextCentury:"Следующее столетье",pickHour:"Выбрать час",incrementHour:"Увеличить час",decrementHour:"Уменьшить час",pickMinute:"Выбрать минуту",incrementMinute:"Увеличить минуту",decrementMinute:"Уменьшить минуту",pickSecond:"Выбрать секунду",incrementSecond:"Увеличить секунду",decrementSecond:"Уменьшить секунду",togglePeriod:"Переключить период",selectTime:"Выбрать время"}}),a(),t.find("input").on("blur",function(){a()})}}})}(),function(){"use strict";angular.module("components.atomDatetimepicker").controller("AtomDatetimepickerCtrl",["$scope","$rootScope",function(e,t){e.vm={message:"Bootstrap DateTimePicker Directive",dateTime:{}},e.$watch("change",function(){console.log(e.vm.dateTime)})}])}(),function(){"use strict";angular.module("components.atomDatepicker",[])}(),function(){"use strict";angular.module("components.atomDatepicker").directive("atomDatepicker",["SessionService",function(e){return{restrict:"A",controller:["$scope","$element","uibDatepickerPopupConfig",function(e,t,n){var a=t.find("input").attr("name");return n.clearText="Очистить",n.closeText="Закрыть",n.currentText="Сегодня",e.today=function(){return e.dt=new Date,e.dt},e.form.hasOwnProperty(a)&&e.form[a]?e.dt=new Date(1e3*e.form[a].sec):e.today(),e.open=function(t){return t.preventDefault(),t.stopPropagation(),e.opened=!0,e.opened},e.dateOptions={"year-format":"'yy'","starting-day":1},e.$watch("dt",function(){e.form[a]=e.dt.toString().replace(/( \((.+)\))/g,""),e.$emit("setDateVar",e.dt)}),e.$watch("form.date",function(){e.form[a]||e.today()}),e.format="dd.MM.yyyy",e.format}]}}])}(),function(){"use strict";angular.module("components.aclMarkup",[])}(),function(){"use strict";angular.module("components.aclMarkup").directive("aclMarkup",function(){return{restict:"AE",controller:["$scope","$q","EntityService","AuthService","_",function(e,t,n,a,i){t.all([a.properties(),n.getEntities()]).then(function(t){var n=t[0].data.entities,a=t[1].data,o=i.map(a,function(e,t){return e.name=t,e.position=angular.isDefined(n[t])?n[t].position:1001,e});o.unshift({title:"Административная панель",name:"atom",position:0}),o.unshift({title:"Сайт",name:"index",position:0}),o=i.sortBy(o,function(e){return e.position}),i.each(o,function(t){var n=t.name;"undefined"==typeof e.optionsData[e.key].sourceValues[n]&&(e.optionsData[e.key].sourceValues[n]={}),e.optionsData[e.key].sourceValues[n].title=t.title,e.optionsData[e.key].sourceValues[n].key=n,e.optionsData[e.key].options.push(e.optionsData[e.key].sourceValues[n])})})}]}})}(),angular.module("ngLocale",[],["$provide",function(e){var t={ZERO:"zero",ONE:"one",TWO:"two",FEW:"few",MANY:"many",OTHER:"other"};e.value("$locale",{DATETIME_FORMATS:{AMPMS:["до полудня","после полудня"],DAY:["воскресенье","понедельник","вторник","среда","четверг","пятница","суббота"],MONTH:["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"],SHORTDAY:["вс","пн","вт","ср","чт","пт","сб"],SHORTMONTH:["янв.","февр.","марта","апр.","мая","июня","июля","авг.","сент.","окт.","нояб.","дек."],fullDate:"EEEE, d MMMM y 'г'.",longDate:"d MMMM y 'г'.",medium:"dd.MM.yyyy H:mm:ss",mediumDate:"dd.MM.yyyy",mediumTime:"H:mm:ss","short":"dd.MM.yy H:mm",shortDate:"dd.MM.yy",shortTime:"H:mm"},NUMBER_FORMATS:{CURRENCY_SYM:"руб.",DECIMAL_SEP:",",GROUP_SEP:" ",PATTERNS:[{gSize:3,lgSize:3,macFrac:0,maxFrac:3,minFrac:0,minInt:1,negPre:"-",negSuf:"",posPre:"",posSuf:""},{gSize:3,lgSize:3,macFrac:0,maxFrac:2,minFrac:2,minInt:1,negPre:"-",negSuf:" ¤",posPre:"",posSuf:" ¤"}]},id:"ru-ru",pluralCat:function(e){return e%10==1&&e%100!=11?t.ONE:e==(0|e)&&e%10>=2&&4>=e%10&&(12>e%100||e%100>14)?t.FEW:e%10==0||e==(0|e)&&e%10>=5&&9>=e%10||e==(0|e)&&e%100>=11&&14>=e%100?t.MANY:t.OTHER}})}]),function(){"use strict";angular.module("atom",["ngAnimate","ngCookies","ngTouch","ngSanitize","vAccordion","ng.deviceDetector","ui.router","ui.tinymce","ui.bootstrap","ui.tree","ngScrollable","underscore","localytics.directives","components.session","components.auth","components.siteHeader","components.navbar","components.collapseNav","components.entity","components.pagination","components.buildFormMarkup","components.atomDatepicker","components.entityMarkup","components.aclMarkup","components.popup","components.atomPassword","components.atomFile","components.atomDatetimepicker","components.helper","bootstrapLightbox","authorization","dashboard","entityPage","errorPage"])}(),function(){"use strict";angular.module("atom").run(["$rootScope","$state","$http","SessionService","EntityService",function(e,t,n,a,i){e.$on("$stateChangeSuccess",function(n,o,s,r){if(e.activePage=o.name,e.activeEntity="pagesList"===o.name?"page":s.entity,!("logout"===r.name&&"login"===o.name||"login"===r.name&&"logout"===o.name)){"error500"==r.name&&(e.activePage=o.name,e.activeEntity=s.entity,e.hidePanels=!1);var l=["login","logout"],c=a.getSessionID();c&&(e.authorized=!0,i.getEntity("user",a.getUserID()).then(function(n){n.data.error&&403==n.data.error.code?t.go("logout"):e.userName=n.data.data[0].title},function(){t.go("logout")})),Lazy(l).contains(o.name)||c||t.go("logout"),c&&"login"===o.name&&t.go("dashboard")}})}])}(),function(){"use strict";angular.module("atom").constant("toastr",toastr).constant("moment",moment).constant("baseURL",BASE_URI).constant("debug",-1!==window.location.search.indexOf("debug")).constant("loginPeriod",18e5)}(),function(){"use strict";angular.module("atom").config(["$logProvider","$httpProvider","$stateProvider","toastr","SessionServiceProvider",function(e,t,n,a,i){t.defaults.headers.post={Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"},t.defaults.headers.get={Accept:"application/json"},i.$get().getSessionID()&&(t.defaults.headers.common.Token=i.$get().getSessionID()),t.interceptors.push(["$q","$injector","_","loginPeriod",function(e,t,n,i){return{request:function(e){var n=t.get("$cookies").get("rememberMe"),a=t.get("$cookies").get("token"),o=t.get("$cookies").get("homepage");if(a&&"0"===n){var s=new Date;s.setTime(s.getTime()+i);var r={expires:s,path:"/"};t.get("$cookies").put("token",a,r),t.get("$cookies").put("rememberMe",a,r),t.get("$cookies").put("homepage",o,r)}return e},responseError:function(i){return 500==i.status&&(t.get("$rootScope").errorMessage=i.data.error.message,t.get("$state").go("error500")),401==i.status&&"/user/logout/"!==i.config.url?t.get("$state").go("logout"):400==i.status?i.data.error.message&&a.error(i.data.error.message):403==i.status?"/atom/properties/"==i.config.url&&(i.data.error.message&&a.error(i.data.error.message),t.get("$state").go("logout")):n.each(i.data.error["null"],function(e){e.message&&a.error(e.message)}),e.reject(i)}}}]),e.debugEnabled(!0),a.options.timeOut=3e3,a.options.positionClass="toast-top-right",a.options.preventDuplicates=!1,a.options.closeButton=!0}])}(),angular.module("atom").run(["$templateCache",function(e){e.put("app/components/atomDatetimepicker/atomDatetimepicker.html","<input type=text class=form-control id={{dataName}} name={{dataName}}> <span class=input-group-addon><i class=fa ng-class=\"{\n    'fa-calendar': (dataType === 'date' || dataType === 'datetime'),\n    'fa-clock-o':  dataType === 'time'\n    }\"></i> </span>"),e.put("app/components/navbar/navbar.html",'<div class=nav-wrapper><ul id=nav class=nav data-slim-scroll data-collapse-nav data-highlight-active><li class=infoblockMenu class="open active"><a href=#/pages><i class="fa fa-file-text-o"></i><span data-i18n=Pages>Инфоблоки</span></a><ul><li ng-repeat="(pageName, page) in pages" ng-if=page.icon ng-class="{\'active\': $root.activeEntity == page.entityName}"><a ui-sref="entitiesList({\'entity\': page.entityName})"><i class="fa {{page.icon}}"></i> <span data-i18n=PageNamePlaceHere>{{ page.title }}</span></a></li></ul></li></ul></div>'),e.put("app/components/pagination/pagination.html",'<footer class=table-footer><div class=row><div class="col-md-6 page-num-info"><span>Элементов на странице:&nbsp;<select data-ng-model=perPage data-ng-options="num.title for num in numPerPageOpt track by num.value" data-ng-change=onNumPerPageChange()></select></span></div><div class="col-md-6 text-right pagination-container scrollme" id=pagination ng-scrollable=scrollConfig><ul class="pagination-sm pagination"><!--<li ng-class="{disabled: noPrevious()}"><a ng-click="prevPage(true);" href="">Первая</a>--><!--</li>--><!--<li ng-class="{disabled: noPrevious()}"><a ng-click="prevPage();" href="">‹</a>--><!--</li>--><li ng-repeat="(pageId,page) in pagesCountList" ng-class="{active: isActive(pageId)}" ng-show=isInRange(pageId)><a ng-bind=page ng-click="goToPage(page - 1);" href=""></a></li><!--<li ng-class="{disabled: noNext()}"><a ng-click="nextPage();" href="">›</a></li>--><!--<li ng-class="{disabled: noNext()}"><a ng-click="nextPage(true);" href="">Последняя</a>--><!--</li>--></ul></div></div></footer>'),e.put("app/components/popup/popup.html",'<div class=modal-header><h3>Удаление</h3></div><div class=modal-body><span ng-if=title><strong>{{title}}</strong><br></span>{{ message }}</div><div class=modal-footer><button class="btn btn-primary" ng-click=ok()>Удалить</button> <button class="btn btn-warning" ng-click=cancel()>Отмена</button></div>'),e.put("app/components/siteHeader/siteHeader.html",'<header class="top-header clearfix"><!-- Logo --><div class=logo><a href=#/ ><!-- <span class="logo-icon glyphicon glyphicon-fire"></span> --> <span>ATOM</span></a></div><!-- needs to be put after logo to make it working--><div class=menu-button ng-click="$root.toggleCanvas = !$root.toggleCanvas"><span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></div><div class=top-nav><ul class="nav-right pull-right list-unstyled"><li class="dropdown text-normal nav-profile" uib-dropdown><a href=javascript:; class=dropdown-toggle uib-dropdown-toggle><span>{{$root.userName}}</span></a><ul class="dropdown-menu with-arrow pull-right"><li><a ui-sref=logout><i class="fa fa-sign-out"></i> <span data-i18n="Log Out">Выход</span></a></li></ul></li></ul></div></header>'),e.put("app/modules/authorization/authorization.html",'<div class=page-signin><div class=signin-header><section class="logo text-center"><a href=#/ >ATOM</a></section></div><div class=main-body><div class=container><div class=form-container><form class=form-horizontal ng-submit=makeLogin() autocomplete=off><fieldset><input style=display:none> <input type=password style=display:none><div class=form-group><div class="btn-icon-lined btn-icon-round btn-icon-sm btn-default-light"><span class="glyphicon glyphicon-envelope"></span></div><input type=email class="form-control input-lg input-round text-center" placeholder=Email ng-model=user.email></div><div class=form-group><div class="btn-icon-lined btn-icon-round btn-icon-sm btn-default-light"><span class="glyphicon glyphicon-lock"></span></div><input type=password class="form-control input-lg input-round text-center" placeholder=Пароль ng-model=user.password></div><div class=form-group><label class="ui-checkbox rememberMeLabel"><input name=checkbox1 type=checkbox value=option2 ng-model=rememberMe> <span>Запомнить меня</span></label></div><div class=form-group><input type=submit class="btn btn-primary btn-lg btn-round btn-block text-center" value=Войти></div></fieldset></form></div></div></div></div>'),e.put("app/modules/dashboard/dashboard.html",""),e.put("app/modules/errorPage/500.html",'<div class=page-err><div class="err-container text-center"><div class=err><div class=err-inner><h1>500</h1><h2>Server Error</h2></div></div><div class=err-mss><p>{{$root.errorMessage}}</p></div><div class=err-body><a ui-sref=dashboard class="btn btn-lg btn-primary" ng-click=closeError()><span class="glyphicon glyphicon-home"></span> <span class=space></span> Вернуться на главную</a></div></div><!--     <div class="footer text-center">\r\n          Copyright 2014 {{main.brand}} Admin\r\n      </div> --></div>'),e.put("app/modules/entityPage/entitiesList/entitiesList.html",'<div class=page style="position: relative"><section data-ng-show=renderData class="panel panel-default table-dynamic"><div style="position: relative" class="panel-heading text-right"><div id=table-title style="position: absolute; left: 10px; top: 20px; font-weight: 600" data-ng-bind=tableTitle></div><button tooltip="Добавить новый элемент" tooltip-placement=top tooltip-append-to-body=true ng-show=createEnabled class="btn btn-success btn-w-md listControlButtons" type=button ng-click=new()>Добавить</button><!--go(,true);--> <button tooltip="Экспорт элементов в XLS" tooltip-placement=top tooltip-append-to-body=true ng-show=exportEnabled class="btn btn-primary btn-w-md listControlButtons" ng-click=exportStack(); type=button>Выгрузить</button> <button tooltip="Удалить выбранные элементы" tooltip-placement=top tooltip-append-to-body=true ng-show=deleteEnabled ng-disabled=isSelectItems(); class="btn btn-danger btn-w-md listControlButtons" ng-click=deleteStack(); type=button>Удалить</button><form method=post id=downloadForm></form></div><div data-ng-show="list.scheme && hasSearchFields" class=table-filters><div class=row><div class="col-sm-4 col-xs-6"><form class="ng-scope ng-pristine ng-valid"><div class=input-group><input type=text placeholder=Поиск... class="form-control ng-pristine ng-valid" ng-model=searchKeywords ng-keyup=keyUpHandler($event) ng-class="{\'input-danger\': searchKeywordsError}"> <span class=input-group-addon ng-click=search()><i class="fa fa-search"></i></span></div><input type=hidden value="" id=hidden-q></form></div><!--<div class="col-sm-3 col-xs-6 filter-result-info">\r\n            <span>\r\n                Showing {{filteredStores.length}}/{{stores.length}} entries\r\n            </span>\r\n        </div>--></div></div><div class=panel-body><section class=table-flip-scroll><table id=table-{{model}} class="table table-bordered table-striped cf"><thead class=cf><tr><th style="padding-left: 10px; height: 41px" class=checkAll-th><div class=th style="padding-left: 0px;padding-right: 0px"><label style="margin-right: 0" class=ui-checkbox><input class=remAll type=checkbox value="" data-ng-click=selectAllItems($event);> <span></span></label></div></th><th style="height: 41px" ng-repeat="(fieldKey, field) in list.scheme" ng-if="field.sort && fieldKey !== \'enabled\' "><div class=th>{{field.title}} <span class=arrows-sort><span ng-show=field.sort class="fa fa-angle-up" ng-click=" order(fieldKey,-1) " ng-class="{active: curSortField == fieldKey && curSortOrder == -1 }"></span> <span ng-show=field.sort class="fa fa-angle-down" ng-click=" order(fieldKey,1) " ng-class="{active: curSortField == fieldKey && curSortOrder == 1 }"></span></span></div></th><th style="height: 41px" ng-if=list.scheme.enabled><div class=th>Доступность <span class=arrows-sort><span class="fa fa-angle-up" ng-click=" order(\'enabled\',-1) " ng-class="{active: curSortField == \'enabled\' && curSortOrder == -1 }"></span> <span class="fa fa-angle-down" ng-click=" order(\'enabled\',1) " ng-class="{active: curSortField == \'enabled\' && curSortOrder == 1 }"></span></span></div></th><th style="height: 41px" class=action-th><div class=th>Действия</div></th></tr></thead><tbody><tr ng-repeat="item in renderData"><td style="height: 41px" class=testx style="width: 15px; padding-left: 10px; padding-right: 0px"><label style="margin-right: 0" class=ui-checkbox><input class=remBox type=checkbox value="{{ item._id.$id }}" ng-click=updateRemItems($event);> <span></span></label></td><td class=fieldCell style="height: 41px" list-wrapp={{item[fieldKey]}} ng-repeat="(fieldKey, field) in list.scheme" ng-if="field.sort && fieldKey !== \'enabled\'" entity-list-markup entity=item[fieldKey] entity-name=fieldKey field=field>{{item[fieldKey]}}</td><td style="height: 41px" class=visible-td ng-if=list.scheme.enabled><!--<label class="switch"  data-atom-toggle-visible="" data-model="{{model}}" data-id="{{itemId|ObjectKey:list.data}}" >--><label class=switch data-atom-toggle-visible="" data-model={{model}} data-id={{itemId}}><input type=checkbox data-ng-model=item.enabled ng-change=setEdited(item)> <i class=slim></i></label></td><td style="height: 41px" class=action-td><a tooltip="Просмотр и редактирование элемента" tooltip-placement=left tooltip-append-to-body=true class="btn-icon btn-icon-min-sm btn-edit" ui-sref="entityEdit({ entity: model, id: item._id.$id })"><i ng-if=editEnabled class="glyphicon glyphicon-pencil"></i> <i ng-if=!editEnabled class="fa fa-th-list"></i> </a><!--<a class="btn-icon btn-icon-min-sm btn-remove cursor-pointer" data-rem-id="{{itemId|ObjectKey:list.data}}" data-ng-click="delete($event);">--> <a tooltip="Удалить элемент" tooltip-placement=left tooltip-append-to-body=left ng-show=deleteEnabled class="btn-icon btn-icon-min-sm btn-remove cursor-pointer" data-rem-id={{itemId}} data-ng-click="deleteStack(item._id[\'$id\']);"><i class="glyphicon glyphicon-trash"></i></a></td></tr></tbody></table></section></div><atom-pagination></atom-pagination></section><div data-ng-hide=renderData class="form-group refresh-position"><div class="col-md-12 text-center"><span style="font-size: 24px" class="glyphicon glyphicon-refresh glyphicon-refresh-animate"></span></div></div></div>'),e.put("app/modules/entityPage/entityEdit/entityEdit.html",'<div class=page><div ng-hide=formSchema class="form-group refresh-position"><div class="col-md-12 text-center"><span style="font-size: 24px" class="glyphicon glyphicon-refresh glyphicon-refresh-animate"></span></div></div><section ng-show=formSchema class="panel panel-default"><div class=panel-heading><strong data-ng-show=isNew><span class="glyphicon glyphicon-th"></span> Создание элемента</strong> <strong data-ng-hide=isNew><span class="glyphicon glyphicon-th"></span> Редактирование элемента <span ng-if=itemTitle>"<span class=edit-item-title>{{itemTitle}}</span>"</span></strong></div><div class=panel-body><div class=row><div class=ui-tab-container ng-if="tabsCount > 1"><tabset class=ui-tab><tab heading={{tabTitle}} ng-repeat="(tabKey, tabTitle) in tabs"><form class=form-horizontal autocomplete=off><input type=text style=display:none id=email name=email> <input type=password style=display:none id=password name=password><div class=form-group ng-if="field.tab === tabKey" ng-show="field.visible !== false" ng-repeat="(key,field) in formSchema" build-form-markup="" markup-data={{field}} field-readonly={{!updateEnabled}}></div><div class="form-group edit-buttons"><div class=col-sm-2></div><div class=col-sm-10><div class=pull-right><!--<a  class="btn btn-w-md btn-gap-v btn-warning">Отмена</a>--><div class="btn-group dropup pull-right margin-right-10" uib-dropdown><button type=button ng-click=goToList() class="btn btn-warning">Отменить</button> <button type=button class="btn btn-warning dropdown-toggle" uib-dropdown-toggle><span class=caret></span> <span class=sr-only>Toggle Dropdown</span></button><ul class="dropdown-menu pull-right"><li><a href=javascript:; ng-click=rollback();>Отменить изменения</a></li><li><a ui-sref="entitiesList({\'entity\': entity })">Вернуться к списку</a></li></ul></div></div><div ng-if=deleteEnabled class="btn-group dropup pull-right margin-right-10" ng-show=!isNew uib-dropdown><button type=button ng-click=remove() class="btn btn-danger">Удалить</button> <button type=button class="btn btn-danger dropdown-toggle" uib-dropdown-toggle><span class=caret></span> <span class=sr-only>Toggle Dropdown</span></button><ul class="dropdown-menu pull-right"><!--<li><a href="javascript:;">Предварительный просмотр</a></li>--><li><a href=javascript:; ng-click=clear();>Очистить форму</a></li><li><a href=javascript:; ng-click=remove();>Удалить запись</a></li></ul></div><button ng-show=!deleteEnabled class="btn btn-danger pull-right margin-right-10 btn-w-md listControlButtons" ng-click=clear(); type=button>Очистить форму</button><div ng-if=updateEnabled class="btn-group dropup pull-right margin-right-10" uib-dropdown><button ng-click=save(true) type=button class="btn btn-primary">Сохранить</button> <button type=button class="btn btn-primary dropdown-toggle" uib-dropdown-toggle><span class=caret></span> <span class=sr-only>Toggle Dropdown</span></button><ul class="dropdown-menu pull-right"><!--<li><a href="javascript:;">Предварительный просмотр</a></li>--><li><a href=javascript:; ng-click=save(true);close()>Сохранить и вернуться к списку</a></li><li><a href=javascript:; ng-click=save(false);>Сохранить и остаться</a></li></ul></div></div></div></form></tab></tabset></div></div><form ng-if="tabsCount === 1" class=form-horizontal autocomplete=off><input type=text style="position: absolute;left: -1000px"> <input type=password style="position: absolute;left: -1000px"><div class=form-group ng-show="field.visible !== false" ng-repeat="(key,field) in formSchema" build-form-markup="" markup-data={{field}} field-readonly={{!updateEnabled}}></div><div class=form-group><div class=col-sm-2></div><div class=col-sm-10><div class=pull-right><!--<a  class="btn btn-w-md btn-gap-v btn-warning">Отмена</a>--><div class="btn-group dropup pull-right margin-right-10" uib-dropdown><button type=button ng-click=goToList() class="btn btn-warning">Отменить</button> <button ng-show=updateEnabled type=button class="btn btn-warning dropdown-toggle" uib-dropdown-toggle><span class=caret></span> <span class=sr-only>Toggle Dropdown</span></button><ul ng-show=updateEnabled class="dropdown-menu pull-right"><li><a href=javascript:; ng-click=rollback();>Отменить изменения</a></li><li><a ui-sref="entitiesList({\'entity\': entity })">Вернуться к списку</a></li></ul></div></div><div ng-show=deleteEnabled class="btn-group dropup pull-right margin-right-10" ng-show=!isNew uib-dropdown><button type=button ng-click=remove() class="btn btn-danger">Удалить</button> <button type=button class="btn btn-danger dropdown-toggle" uib-dropdown-toggle><span class=caret></span> <span class=sr-only>Toggle Dropdown</span></button><ul class="dropdown-menu pull-right"><!--<li><a href="javascript:;">Предварительный просмотр</a></li>--><li><a href=javascript:; ng-click=clear();>Очистить форму</a></li><li><a href=javascript:; ng-click=remove();>Удалить элемент</a></li></ul></div><div ng-if=updateEnabled class="btn-group dropup pull-right margin-right-10" uib-dropdown><button ng-click=save(true) type=button class="btn btn-primary">Сохранить</button> <button type=button class="btn btn-primary dropdown-toggle" uib-dropdown-toggle><span class=caret></span> <span class=sr-only>Toggle Dropdown</span></button><ul class="dropdown-menu pull-right"><!--<li><a href="javascript:;">Предварительный просмотр</a></li>--><li><a href=javascript:; ng-click=save(true);close()>Сохранить и вернуться к списку</a></li><li><a href=javascript:; ng-click=save(false);>Сохранить и остаться</a></li></ul></div></div></div></form></div></section></div>'),
e.put("app/modules/entityPage/pagesList/items_renderer.html",'<div ng-init="hovered = false" ng-mouseover=hoverIn(this); ng-mouseleave=hoverOut(this) ng-class="{\'angular-ui-tree-handle\': item.isRoot === false}" ng-attr-data-nodrag="{{item.isRoot === true}}" class=angular-ui-tree-handle-nodrag><span data-ng-show="item.items.length > 0"><a class=angular-ui-tree-icon data-nodrag ng-click=toggle(this)><span class=angular-ui-tree-icon-collapse ng-class="{\'collapsed\': collapsed, \'uncollapsed\': !collapsed}"></span> </a></span>{{item.title}} <a ng-show=hovered ng-if=!item.isRoot class="pull-right btn-icon btn-icon-min-sm btn-danger" data-nodrag ng-click="removeItem(item, remove)" href=javascript:void(0)><i class="glyphicon glyphicon-trash"></i> </a><a ng-show=hovered ng-if=!item.isRoot class="pull-right btn-icon btn-icon-min-sm btn-edit" data-nodrag ui-sref="entityEdit({ entity: \'page\', id: item._id.$id })"><i class="glyphicon glyphicon-pencil"></i> </a><a ng-show=hovered class="pull-right btn-icon btn-icon-min-sm btn-success" data-nodrag ui-sref="entityAddPage({ entity: \'page\', pid: item._id.$id })"><i class="glyphicon glyphicon-plus"></i></a></div><ol ui-tree-nodes=options ng-model=item.items ng-class="{hidden: collapsed}"><li ng-repeat="item in item.items" ui-tree-node ng-include="\'app/modules/entityPage/pagesList/items_renderer.html\'"></li></ol>'),e.put("app/modules/entityPage/pagesList/pagesList.html",'<div class="page page-table" style="position: relative"><div data-ng-hide=list.scheme class=dummy-height></div><section data-ng-show=list.scheme class="panel panel-default"><div class=panel-heading><strong><span class="glyphicon glyphicon-th"></span> Текстовые страницы</strong></div><div class=panel-body><div ui-tree=options><ol ui-tree-nodes ng-model=data data-nodrop-enabled><li ng-repeat="item in data" ui-tree-node ng-include="\'app/modules/entityPage/pagesList/items_renderer.html\'"></li></ol></div></div></section><div data-ng-hide=list.scheme class="form-group refresh-position"><div class="col-md-12 text-center"><span style="font-size: 24px" class="glyphicon glyphicon-refresh glyphicon-refresh-animate"></span></div></div></div>')}]);